{{ block title }}
    Complete the study parts
{{ endblock }}
{{ block content }}
    <p>
        Please complete the parts one after the other. The link to the next part is revealed after entering the completion code of the previous one.
    </p>
    <div class="container card m-3 p-3" id="study_container_1">
        <div class="row"  style="text-align: center">
            <div class="col">Enter completion code for part 1:</div>
        </div>
      <div class="row">
        <div class="col" style="text-align: center">
          <a href="{{ subsession.study_link_1 }}" target="_blank" class="btn btn-primary" id="goto_1">Go to Part 1</a>
        </div>
        <div class="col" style="text-align: center">
           {{ form.study_code_1 }}
        </div>
        <div class="col" style="text-align: center">
            <button type="button" class="btn btn-secondary" id="study_confirm_1">Confirm Code</button>
        </div>
      </div>
    </div>

    <div class="container card m-3 p-3" id="study_container_2">
        <div class="row"  style="text-align: center">
            <div class="col">Enter completion code for part 2:</div>
        </div>
      <div class="row">
        <div class="col" style="text-align: center">
          <a href="{{ subsession.study_link_2 }}" target="_blank" class="btn btn-primary" id="goto_2">Go to Part 2</a>
        </div>
        <div class="col" style="text-align: center">
           {{ form.study_code_2 }}
        </div>
        <div class="col" style="text-align: center">
            <button type="button" class="btn btn-secondary" id="study_confirm_2">Confirm Code</button>
        </div>
      </div>
    </div>
    
    <div class="container card m-3 p-3" id="study_container_3">
        <div class="row"  style="text-align: center">
            <div class="col">Enter completion code for part 3:</div>
        </div>
      <div class="row">
        <div class="col" style="text-align: center">
          <a href="{{ subsession.study_link_3 }}" target="_blank" class="btn btn-primary" id="goto_3">Go to Part 3</a>
        </div>
        <div class="col" style="text-align: center">
           {{ form.study_code_3 }}
        </div>
        <div class="col" style="text-align: center">
            <button type="button" class="btn btn-secondary" id="study_confirm_3">Confirm Code</button>
        </div>
      </div>
    </div>

    <div class="container card m-3 p-3" id="study_container_4">
        <div class="row"  style="text-align: center">
            <div class="col">Enter completion code for part 4:</div>
        </div>
      <div class="row">
        <div class="col" style="text-align: center">
          <a href="{{ subsession.study_link_4 }}" target="_blank" class="btn btn-primary" id="goto_4">Go to Part 4</a>
        </div>
        <div class="col" style="text-align: center">
           {{ form.study_code_4 }}
        </div>
        <div class="col" style="text-align: center">
            <button type="button" class="btn btn-secondary" id="study_confirm_4">Confirm Code</button>
        </div>
      </div>
    </div>

    <input type="hidden" name="click_count_link_1" id="id_click_count_link_1" value="0">
    <input type="hidden" name="click_count_link_2" id="id_click_count_link_2" value="0">
    <input type="hidden" name="click_count_link_3" id="id_click_count_link_3" value="0">
    <input type="hidden" name="click_count_link_4" id="id_click_count_link_4" value="0">

    {{ next_button }}

{{ form.errors }}

{{ endblock }}

{{ block scripts }}
    <script>
        const container_1 = document.getElementById('study_container_1');
        const container_2 = document.getElementById('study_container_2');
        const container_3 = document.getElementById('study_container_3');
        const container_4 = document.getElementById('study_container_4');
        
        const study_button_1 = document.getElementById('goto_1');
        const study_button_2 = document.getElementById('goto_2');
        const study_button_3 = document.getElementById('goto_3');
        const study_button_4 = document.getElementById('goto_4');
        
        const opened_input_1 = document.getElementById('id_click_count_link_1');
        const opened_input_2 = document.getElementById('id_click_count_link_2');
        const opened_input_3 = document.getElementById('id_click_count_link_3');
        const opened_input_4 = document.getElementById('id_click_count_link_4');
        
        const study_input_1 = document.getElementById('id_study_code_1');
        const study_input_2 = document.getElementById('id_study_code_2');
        const study_input_3 = document.getElementById('id_study_code_3');
        const study_input_4 = document.getElementById('id_study_code_4');
        
        const confirm_button_1 = document.getElementById('study_confirm_1');
        const confirm_button_2 = document.getElementById('study_confirm_2');
        const confirm_button_3 = document.getElementById('study_confirm_3');
        const confirm_button_4 = document.getElementById('study_confirm_4');
        
        const next_button = document.querySelector('.otree-btn-next');
        
        container_2.style.display = 'none';
        container_3.style.display = 'none';
        container_4.style.display = 'none';
        
        study_input_1.readOnly = true;
        study_input_2.readOnly = true;
        study_input_3.readOnly = true;
        study_input_4.readOnly = true;
        
        confirm_button_1.disabled = true;
        confirm_button_2.disabled = true;
        confirm_button_3.disabled = true;
        confirm_button_4.disabled = true;
        
        next_button.disabled = true;
        
        study_button_1.addEventListener('click', function() {
           opened_input_1.value = parseInt(opened_input_1.value) + 1;
           study_input_1.readOnly = false;
           study_button_1.classList.remove('btn-primary');
           study_button_1.classList.add('btn-secondary');
           confirm_button_1.classList.remove('btn-secondary');
           confirm_button_1.classList.add('btn-primary');
           study_input_1.focus();
        });
        
        study_button_2.addEventListener('click', function() {
           opened_input_2.value = parseInt(opened_input_2.value) + 1;
           study_input_2.readOnly = false;
           study_button_2.classList.remove('btn-primary');
           study_button_2.classList.add('btn-secondary');
           confirm_button_2.classList.remove('btn-secondary');
           confirm_button_2.classList.add('btn-primary');
           study_input_2.focus();
        });
        
        study_button_3.addEventListener('click', function() {
           opened_input_3.value = parseInt(opened_input_3.value) + 1;
           study_input_3.readOnly = false;
           study_button_3.classList.remove('btn-primary');
           study_button_3.classList.add('btn-secondary');
           confirm_button_3.classList.remove('btn-secondary');
           confirm_button_3.classList.add('btn-primary');
           study_input_3.focus();
        });
        
        study_button_4.addEventListener('click', function() {
           opened_input_4.value = parseInt(opened_input_4.value) + 1;
           study_input_4.readOnly = false;
           study_button_4.classList.remove('btn-primary');
           study_button_4.classList.add('btn-secondary');
           confirm_button_4.classList.remove('btn-secondary');
           confirm_button_4.classList.add('btn-primary');
           study_input_4.focus();
        });
        
        study_input_1.addEventListener('input', function() {
           confirm_button_1.disabled = this.value.trim() === "";
        });
        
        study_input_2.addEventListener('input', function() {
           confirm_button_2.disabled = this.value.trim() === "";
        });
        
        study_input_3.addEventListener('input', function() {
           confirm_button_3.disabled = this.value.trim() === "";
        });
        
        study_input_4.addEventListener('input', function() {
           confirm_button_4.disabled = this.value.trim() === "";
        });
        
        confirm_button_1.addEventListener('click', function() {
           container_2.style.display = 'block';
           study_input_1.readOnly = true;
           confirm_button_1.disabled = true;
        });
        
        confirm_button_2.addEventListener('click', function() {
           container_3.style.display = 'block'; 
           study_input_2.readOnly = true;
           confirm_button_2.disabled = true;
        });
        
        confirm_button_3.addEventListener('click', function() {
           container_4.style.display = 'block'; 
           study_input_3.readOnly = true;
           confirm_button_3.disabled = true;
        });
        
        confirm_button_4.addEventListener('click', function() {
           next_button.disabled = false; 
           study_input_4.readOnly = true;
           confirm_button_4.disabled = true;
        });
    </script>
{{ endblock }}

{{ block styles }}
    <link rel="stylesheet" href="{{ static 'global/custom.css' }}">
{{ endblock }}
